package com.example.gestionaulas;import android.app.ProgressDialog;import android.content.DialogInterface;import android.os.Bundle;import androidx.activity.OnBackPressedCallback;import androidx.annotation.NonNull;import androidx.appcompat.app.AlertDialog;import androidx.appcompat.app.AppCompatActivity;import androidx.fragment.app.Fragment;import androidx.navigation.fragment.NavHostFragment;import android.util.Log;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.AdapterView;import android.widget.Button;import android.widget.Spinner;import com.example.gestionaulas.model.Horario;import com.example.gestionaulas.model.Reserva;import com.google.firebase.database.DataSnapshot;import com.google.firebase.database.DatabaseError;import com.google.firebase.database.FirebaseDatabase;import com.google.firebase.database.ValueEventListener;import java.text.ParseException;import java.text.SimpleDateFormat;import java.util.ArrayList;import java.util.Date;import java.util.HashSet;import java.util.List;import java.util.Locale;import java.util.Set;import static com.example.gestionaulas.MainActivity.mostrarAulas;import static com.example.gestionaulas.MainActivity.mostrarReservas;import static com.example.gestionaulas.MainActivity.obtenerDia;/** * A simple {@link Fragment} subclass. * Use the {@link ConsultaFragment#newInstance} factory method to * create an instance of this fragment. */public class ConsultaFragment extends Fragment {    Spinner dia, hora;    Button consulta;    ProgressDialog progressDialog;    private static final String ARG_PARAM1 = "param1";    private static final String ARG_PARAM2 = "param2";    private String mParam1;    private String mParam2;    public ConsultaFragment() {        // Required empty public constructor    }    /**     * Use this factory method to create a new instance of     * this fragment using the provided parameters.     *     * @param param1 Parameter 1.     * @param param2 Parameter 2.     * @return A new instance of fragment ConsultaFragment.     */    public static ConsultaFragment newInstance(String param1, String param2) {        ConsultaFragment fragment = new ConsultaFragment();        Bundle args = new Bundle();        args.putString(ARG_PARAM1, param1);        args.putString(ARG_PARAM2, param2);        fragment.setArguments(args);        return fragment;    }    @Override    public void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        if (getArguments() != null) {            mParam1 = getArguments().getString(ARG_PARAM1);            mParam2 = getArguments().getString(ARG_PARAM2);        }        OnBackPressedCallback callback = new OnBackPressedCallback(true) {            @Override            public void handleOnBackPressed() {                salir();            }        };        progressDialog = new ProgressDialog(getContext());        requireActivity().getOnBackPressedDispatcher().addCallback(this, callback);        ((AppCompatActivity) getActivity()).getSupportActionBar().show();    }    @Override    public View onCreateView(LayoutInflater inflater, ViewGroup container,                             Bundle savedInstanceState) {        View v = inflater.inflate(R.layout.consulta_fragment, container, false);        hora = v.findViewById(R.id.consulta_hora);        dia = v.findViewById(R.id.consulta_dia);        consulta = v.findViewById(R.id.consulta_boton);        final String[] mHora = new String[1];        final String[] mDia = new String[1];        hora.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {            @Override            public void onItemSelected(AdapterView<?> parent, View view, int position, long id) {                mHora[0] = hora.getSelectedItem().toString();            }            @Override            public void onNothingSelected(AdapterView<?> parent) {            }        });        dia.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {            @Override            public void onItemSelected(AdapterView<?> parent, View view, int position, long id) {                mDia[0] = dia.getSelectedItem().toString();            }            @Override            public void onNothingSelected(AdapterView<?> parent) {            }        });        consulta.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                progressDialog.setMessage("Consultando");                progressDialog.setProgressStyle(ProgressDialog.STYLE_SPINNER);                progressDialog.show();                MiExecutor.getInstance().execute(new Runnable() {                    @Override                    public void run() {                        Bundle d = new Bundle();                        d.putInt("DIA", Integer.parseInt(obtenerDia(mDia[0])));                        d.putInt("HORA", Integer.parseInt(mHora[0]));                        mostrarReservas(Integer.parseInt(mHora[0]), Integer.parseInt(obtenerDia(mDia[0])));                        mostrarAulas(Integer.parseInt(mHora[0]), Integer.parseInt(obtenerDia(mDia[0])));                        NavHostFragment.findNavController(ConsultaFragment.this)                                .navigate(R.id.action_global_listaFragment, d);                    }                });                progressDialog.dismiss();            }        });        return v;    }    private void salir() {        AlertDialog.Builder builder = new AlertDialog.Builder(getContext());        builder.setMessage("Seguro que quieres salir?");        builder.setTitle("Salir");        builder.setPositiveButton("Si", new DialogInterface.OnClickListener() {            @Override            public void onClick(DialogInterface dialog, int which) {                getActivity().finish();            }        });        builder.setNegativeButton("No", new DialogInterface.OnClickListener() {            @Override            public void onClick(DialogInterface dialog, int which) {                dialog.cancel();            }        });        AlertDialog dialog = builder.create();        dialog.show();    }}